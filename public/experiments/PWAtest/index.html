<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <style>
        body {
            font-size: 2em;
            background-image: url("images/nominal saving.jpeg");
            background-repeat: no-repeat;
            background-position: center;
            background-size: cover;
            color: white;
            margin: 0;
            overflow: hidden;
        }

        h1 {
            text-align: center;
            font-family: 'Noto Sans TC', sans-serif;
        }

        body>div {
            display: none;
            position: absolute;
            top: 0;
            background-color: rgba(0, 0, 0, 0.7);
            animation: shower 0.5s;
            width: 100%;
            height: 100%;
            padding: 30px;
            box-sizing: border-box;
        }

        .title {
            display: table;
            width: 100%;
            height: 100%;
        }

        .title>div {
            display: table-cell;
            height: 100%;
            vertical-align: middle;
            text-align: center;


        }

        button {
            background: lavender;
            font-size: 1em;
            padding: 30px;
            border-radius: 1em;
        }

        .list>div {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .list>div>div {
            overflow-y: auto;
        }

        .list>div>div>div {
            padding: 30px;
            margin-bottom: 30px;
            background: rebeccapurple;
        }

        .list>div>div>div.going {
            background: mediumpurple;
        }

        .list>div>div>div .rgst {
            display: block;
        }

        .list>div>div>div.going .rgst {
            display: none;
        }

        .list>div>div>div .gvng {
            display: none;
        }

        .list>div>div>div.going .gvng {
            display: block;
        }

        .hidden {
            animation: hider 0.5s;
            animation-fill-mode: forwards;
        }

        .ticket {
            text-align: center;
            background-color: rgba(0, 200, 0, 0.7);
        }

        .ticket>:last-child {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
        }

        input {
            font-size: 1em;
        }

        @keyframes hider {
            from {
                opacity: 100;
            }

            to {
                opacity: 0;
                z-index: -1;
            }
        }

        @keyframes shower {
            from {
                opacity: 0;
            }

            to {
                opacity: 100;
            }
        }

        .signup {
            text-align: center;
        }
    </style>
    <script src="../../jquery.min.js"></script>
    <script>
        //handle installation

    if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('sw.js').then(function(registration) {
      // Registration was successful
      console.log('ServiceWorker registration successful with scope: ', registration.scope);
    }, function(err) {
      // registration failed :(
      console.log('ServiceWorker registration failed: ', err);
    });
  });
}


        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            console.log("henloo");
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
        });
        window.addEventListener('appinstalled', (evt) => {
            console.log("yayaya");
        });

        $(() => {
            window.history.pushState({}, '');
            if (localStorage.getItem("seenBefore") == "true") {
                gotoList();
            }
            $(".list>div>div").on("click", "div", (e) => {
                if (localStorage.getItem("userData") == undefined) {
                    transitionTo(".signup");
                } else {
                    transitionTo(".selEvent");
                }
            })
            $(".vtk").on("click", () => {
                transitionTo(".ticket");
            })

            $(".signup button")[0].addEventListener("click",()=>{
                //some validation
                if (deferredPrompt){
                deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice
                .then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                        transitionTo(".selEvent");
                    } else {
                        console.log('User dismissed the A2HS prompt');
                        transitionTo(".selEvent");
                    }
                    deferredPrompt = null;
                });
                }else{
                    transitionTo(".selEvent");
                }
                
            })
        })

        function gotoList() {
            localStorage.setItem("seenBefore", "true");
            transitionTo(".list");
        }
        navstack = [".title"];

        function transitionTo(next) {
            $(navstack[navstack.length - 1]).addClass('hidden');
            if (next == undefined) { //going back!
                navstack.pop();
                window.history.pushState({}, '');
            } else {
                navstack.push(next);
            }
            $(navstack[navstack.length - 1]).removeClass('hidden');
            $(navstack[navstack.length - 1]).show();
        }
        window.addEventListener('popstate', function () {
            transitionTo();
        })
        //Free food calendar
        /*
ux flow:
0. Someone tells user that they can access this nifty free food calendar and its better than raksoc's
1. User goes onto website, scrolls thru the first 3 results
2. 4th result says 'Hey there! regular free food conesseur? Help us make your free food experience fast in just 3 steps.
2.1. 1) Enter your name and access number, so you'll never need to be asked for it again.
2.2. 2) Add this site to your homepage, so you can access it quick smart.
2.3. 3) Select food events and we'll notify you so you never forget!
2.4. Yes please / not now
if click yes please:
2.5. Alright! welcome aboard! 
Enter your access number below:
[------------------]
And your name:
[------------------]
Next ->
2.6. Ok, now add us to your homescreen...
[done]
2.7. All good! Now just select the events you're interested in.
2.8. You're all set!
Your next free food event is on xx.xx. When you're there, just open this app and 
tap the 'Going!' button, and you'll be ready to go!

::when an event is tapped
>> event name, organisation, location, event ID, 'Going button'
::when 'Going!' is tapped
>>ADMIT ONE<<
--present this to your event organiser for INSTANT verification!--
--NOTE! You may still need to pay membership fees to the organisation if you are a member. This service is, however, free!
>>event name<<
>>name<<
>>Access<<
--advertisment banner--
>>ADMIT ONE<<

ux for organisers
0. I tell them hoi you can make an event!
1. User navigates to /events
Register an event on usydfoodie
3 fantastic reasons to register your events
- Get Access numbers from attendees with just one tap. No more dodgy google forms!
- Notify hundreds of uni students about your events.
- Set up event schedules in a single click!
usydfoodie: Event planning made EASY.
register-->
click register
4 steps to go:
1. What is your organisation?
[---------]
2. What's the event called?
[---------]
3. Where is the event?
[---------]
4. When is the event?
[---------]
Recurrence:
[]weekly
[]fortnightly
[]monthly
>>OK!>>
Your event:
Event code: 
---org-event-date
event name:
---
organisation:
--- 
location:
---
Attendees:
---
Access number, 
Access

Don't worry if you forget this - just hop on your PC or log on to this app to 
        */
    </script>
</head>

<body>
    <div class="title">
        <div>
            <h1>Hello from Ruth's Ruthies!</h1>
            <p>It's your list of all the free (or semi-free) ACCESS food all in one place!</p>
            <button onclick="gotoList()">View up and coming events</button>
        </div>
    </div>
    <div class="list">
        <div>
            <h1>Free food events</h1>
            <p>Tap on any event for more info.</p>
            <div>
                <div class="going">
                    <h3>Physoc does Nebula spiders!</h3>
                    <em>Feeling starry eyed? Come along and get starry... stomached... as well!</em>
                    <p><span>11th of Nopevember</span> - <span>The Milky Way Bar</span></p>
                    <p class="gvng">You're going!</p>
                    <p class="rgst">Tap to register</p>
                </div>
                <div>
                    <h3>USRC RoboYumCha</h3>
                    <em>With Spring Rolls, Dim Sim-ulations, and Cogwheel Char-siew , delivered by our flying Dumpling
                        Drones!</em>
                    <p><span>12th Juno</span> - <span>USYD Fabrication Lab</span></p>
                    <p class="gvng">You're going!</p>
                    <p class="rgst">Tap to register</p>
                </div>
                <div>
                    <h3>SUITS Cookies and Coding</h3>
                    <em>Whether you're using them to store auth tokens or userdata, we'll show you one thing - cookies
                        never tasted so good.</em>
                    <p><span>11th Maybruary</span> - <span>Somewhere in SIT</span></p>
                    <p class="gvng">You're going!</p>
                    <p class="rgst">Tap to register</p>
                </div>
            </div>
        </div>
    </div>
    <div class="selEvent">
        <h2>Selected event</h2>
        <h3>Brought to you by:<em>PhySoc</em></h3>
        <h3>Time:</h3>
        <p>11th of Nopevember</p>
        <h3>Location:</h3>
        <p>The Milky Way Bar</p>
        <button class="rgst">I'm going!</button><br>
        <button class="gvng vtk">View ticket</button><br>
        <button class="gvng">I can't make it :(</button>
    </div>
    <div class="ticket">
        <!--ticket-->
        <h2>Selected event</h2>
        <p>EVENTCODE</p>
        <h3>Name: Stoofen Lyoo</h3>
        <h3>ACCESS Number: 30456843</h3>
        <h3>Member?</h3>
        <p>Yes/No</p>
        <p>Location</p>
        <div>Press back to go back</div>
    </div>
    <div class="signup">
        <!--ticket-->
        <h2>About you!</h2>
        <p>To help fasttrack the food-getting, prefill your details here!</p>
        <h3>Name</h3>
        <input>
        <h3>ACCESS Number</h3>
        <input type="number">
        <br><br>
        <p>You only ever need to do this once! Your phone will remember your ACCESS number and submit it to the event
            organisers automatically.</p>
        <button>Done!</button>
    </div>
</body>

</html>